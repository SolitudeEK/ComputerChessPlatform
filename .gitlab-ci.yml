stages:
    - test
    - inspect
    - deploydocker
    - test
    - sast
    - snyk_test

before_script:
  - cd ManagementService

test:
    stage: test
    script:
        - dotnet test ManagementService.sln

inspect:
  stage: inspect
  script:
    - dotnet new tool-manifest
    - dotnet tool install JetBrains.ReSharper.GlobalTools --version=2023.1.1
    - dotnet jb inspectcode ManagementService.sln -o=/ManagementReport
    - dotnet tool restore

deploydocker: 
    stage: deploydocker
    script:
        - ./build_services.bat
        
include:
  - template: Security/SAST.gitlab-ci.yml

sast:
  tags:
    - Docker
  before_script:
    - wget https://dot.net/v1/dotnet-install.sh
    - bash ./dotnet-install.sh -c 7.0
    - dotnet new xunit
  artifacts:
    reports:
      sast: gl-sast-report.json

snyk_test:
  script:
    - cd ..
    - snyk monitor --all-projects --org=e79a86d5-5461-42fe-95fc-12ccd74731fd